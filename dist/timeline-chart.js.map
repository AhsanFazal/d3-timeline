{"version":3,"sources":["timeline-chart.js"],"names":[],"mappings":"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","file":"timeline-chart.js","sourcesContent":["class TimelineChart {\n    constructor(element, data, opts) {\n        element.classList.add('timline-chart');\n\n        let options = this.extendOptions(opts);\n\n        let allElements = data.reduce((agg, e) => agg.concat(e.data), []);\n\n        let minDt = d3.min(allElements, this.getPointMinDt);\n        let maxDt = d3.max(allElements, this.getPointMaxDt);\n\n        let elementWidth = options.width || element.clientWidth;\n        let elementHeight = options.height || element.clientHeight;\n\n        let margin = {\n            top: 0,\n            right: 0,\n            bottom: 20,\n            left: 0\n        };\n\n        let width = elementWidth - margin.left - margin.right;\n        let height = elementHeight - margin.top - margin.bottom;\n\n        let groupWidth = 200;\n\n        let x = d3.time.scale()\n            .domain([minDt, maxDt])\n            .range([groupWidth, width]);\n\n        let xAxis = d3.svg.axis()\n            .scale(x)\n            .orient('bottom')\n            .tickSize(-height);\n\n        let zoom = d3.behavior.zoom()\n            .x(x)\n            .scaleExtent([0.1, 20])\n            .on('zoom', zoomed);\n\n        let svg = d3.select(element).append('svg')\n            .attr('width', width + margin.left + margin.right)\n            .attr('height', height + margin.top + margin.bottom)\n            .append('g')\n            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n            .call(zoom);\n\n        svg.append('defs')\n            .append('clipPath')\n            .attr('id', 'chart-content')\n            .append('rect')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        svg.append('rect')\n            .attr('class', 'chart-bounds')\n            .attr('x', groupWidth)\n            .attr('y', 0)\n            .attr('height', height)\n            .attr('width', width - groupWidth)\n\n        svg.append('g')\n            .attr('class', 'x axis')\n            .attr('transform', 'translate(0,' + height + ')')\n            .call(xAxis);\n\n        let groupHeight = height / data.length;\n        let groupSection = svg.selectAll('.group-section')\n            .data(data)\n            .enter()\n            .append('line')\n            .attr('class', 'group-section')\n            .attr('x1', 0)\n            .attr('x2', width)\n            .attr('y1', (d, i) => {\n                return groupHeight * (i + 1);\n            })\n            .attr('y2', (d, i) => {\n                return groupHeight * (i + 1);\n            });\n\n        let groupLabels = svg.selectAll('.group-label')\n            .data(data)\n            .enter()\n            .append('text')\n            .attr('class', '.group-label')\n            .attr('x', 0)\n            .attr('y', (d, i) => {\n                return (groupHeight * i) + (groupHeight / 2) + 5.5;\n            })\n            .attr('dx', '0.5em')\n            .text(d => d.label);\n\n        let lineSection = svg.append('line').attr('x1', groupWidth).attr('x2', groupWidth).attr('y1', 0).attr('y2', height).attr('stroke', 'black');\n\n        let groupIntervalItems = svg.selectAll('.item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', '.item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.INTERVAL))\n            .enter();\n\n\n        let intervalBarHeight = 0.8 * groupHeight;\n        let intervalBarMargin = (groupHeight - intervalBarHeight) / 2;\n        let intervals = groupIntervalItems\n            .append('rect')\n            .attr('class', 'interval')\n            .attr('width', (d) => x(d.to) - x(d.from))\n            .attr('height', intervalBarHeight)\n            .attr('y', intervalBarMargin)\n            .attr('x', (d) => x(d.from));\n\n        let intervalTexts = groupIntervalItems\n            .append('text')\n            .text(d => d.label)\n            .attr('fill', 'white')\n            .attr('class', 'interval-text')\n            .attr('y', (groupHeight / 2) + 5)\n            .attr('x', (d) => x(d.from));\n\n        let groupDotItems = svg.selectAll('.item')\n            .data(data)\n            .enter()\n            .append('g')\n            .attr('clip-path', 'url(#chart-content)')\n            .attr('class', '.item')\n            .attr('transform', (d, i) => `translate(0, ${groupHeight * i})`)\n            .selectAll('.dot')\n            .data(d => d.data.filter(_ => _.type === TimelineChart.TYPE.POINT))\n            .enter();\n\n        let dots = groupDotItems\n            .append('circle')\n            .attr('class', 'dot')\n            .attr('cx', d => x(d.at))\n            .attr('cy', groupHeight / 2)\n            .attr('r', 5);\n\n        if (options.tip) {\n            let tip = d3.tip().attr('class', 'd3-tip').html(options.tip);\n            svg.call(tip);\n            dots.on('mouseover', tip.show).on('mouseout', tip.hide)\n        }\n\n        zoomed();\n\n        function zoomed() {\n            svg.select('.x.axis')\n                .call(xAxis);\n\n            svg.selectAll('circle.dot')\n                .attr('cx', d => x(d.at));\n\n            svg.selectAll('rect.interval')\n                .attr('x', d => x(d.from))\n                .attr('width', d => x(d.to) - x(d.from));\n\n            svg.selectAll('.interval-text').attr('x', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return positionData.upToPosition;\n                    } else if (positionData.xPosition < groupWidth && positionData.upToPosition > groupWidth) {\n                        return groupWidth;\n                    }\n                    return positionData.xPosition;\n                }).attr('text-anchor', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return 'end';\n                    }\n                    return 'start';\n                })\n                .attr('dx', function(d) {\n                    let positionData = getTextPositionData.call(this, d);\n                    if ((positionData.upToPosition - groupWidth - 10) < positionData.textWidth) {\n                        return '-0.5em';\n                    }\n                    return '0.5em';\n                });\n\n            function getTextPositionData(d) {\n                return {\n                    xPosition: x(d.from),\n                    upToPosition: x(d.to),\n                    textWidth: this.getComputedTextLength()\n                }\n            }\n        }\n    }\n    extendOptions(ext = {}) {\n        let defaultOptions = { tip: undefined };\n        Object.keys(ext).map(k => defaultOptions[k] = ext[k]);\n        return defaultOptions;\n    }\n    getPointMinDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.from;\n    }\n    getPointMaxDt(p) {\n        return p.type === TimelineChart.TYPE.POINT ? p.at : p.to;\n    }\n}\n\nTimelineChart.TYPE = {\n    POINT: Symbol(),\n    INTERVAL: Symbol()\n};\n"],"sourceRoot":"/source/"}